name: "Reusable Slack Notification"

on:
  workflow_call:
    inputs:
      type:
        description: "Notification type (start, success, failure, ref-mismatch)"
        required: true
        type: string
      environment:
        description: "Environment name"
        required: true
        type: string
      branch:
        description: "Branch name"
        required: true
        type: string
      actor:
        description: "User who triggered the workflow"
        required: true
        type: string
      workflow:
        description: "Workflow name"
        required: false
        type: string
        default: ""
      workflow-run-url:
        description: "Workflow run URL"
        required: false
        type: string
        default: ""
    secrets:
      SLACK_WEBHOOK_URL:
        description: "Slack webhook URL"
        required: true

jobs:
  slack-notify:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    steps:
      - name: "Send start notification"
        if: ${{ inputs.type == 'start' }}
        uses: slackapi/slack-github-action@v2.1.0
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {
              "text": "üöÄ „Éá„Éó„É≠„Ç§„ÇíÈñãÂßã„Åó„Åæ„Åô",
              "attachments": [
                {
                  "color": "good",
                  "fields": [
                    { "title": "Environment", "value": "${{ inputs.environment }}", "short": true },
                    { "title": "Branch", "value": "${{ inputs.branch }}", "short": true },
                    { "title": "Triggered by", "value": "${{ inputs.actor }}", "short": true },
                    { "title": "Workflow", "value": "${{ inputs.workflow }}", "short": true }
                  ]
                }
              ]
            }
      - name: "Send success notification"
        if: ${{ inputs.type == 'success' }}
        uses: slackapi/slack-github-action@v2.1.0
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {
              "text": "‚úÖ „Éá„Éó„É≠„Ç§„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü",
              "attachments": [
                {
                  "color": "good",
                  "fields": [
                    { "title": "Environment", "value": "${{ inputs.environment }}", "short": true },
                    { "title": "Branch", "value": "${{ inputs.branch }}", "short": true },
                    { "title": "Triggered by", "value": "${{ inputs.actor }}", "short": true },
                    { "title": "Workflow Run", "value": "<${{ inputs.workflow-run-url }}|View Details>", "short": true }
                  ]
                }
              ]
            }
      - name: "Send failure notification"
        if: ${{ inputs.type == 'failure' }}
        uses: slackapi/slack-github-action@v2.1.0
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {
              "text": "‚ùå „Éá„Éó„É≠„Ç§„ÅåÂ§±Êïó„Åó„Åæ„Åó„Åü",
              "attachments": [
                {
                  "color": "danger",
                  "fields": [
                    { "title": "Environment", "value": "${{ inputs.environment }}", "short": true },
                    { "title": "Branch", "value": "${{ inputs.branch }}", "short": true },
                    { "title": "Triggered by", "value": "${{ inputs.actor }}", "short": true },
                    { "title": "Workflow Run", "value": "<${{ inputs.workflow-run-url }}|View Details>", "short": true }
                  ]
                }
              ]
            }
      - name: "Send ref mismatch notification"
        if: ${{ inputs.type == 'ref-mismatch' }}
        uses: slackapi/slack-github-action@v2.1.0
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {
              "text": "‚ö†Ô∏è PRDÁí∞Â¢É„Éá„Éó„É≠„Ç§„Åßref„ÅÆ‰∏çÊï¥Âêà„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü",
              "attachments": [
                {
                  "color": "warning",
                  "fields": [
                    { "title": "Environment", "value": "${{ inputs.environment }}", "short": true },
                    { "title": "Input Ref", "value": "${{ inputs.branch }}", "short": true },
                    { "title": "Triggered by", "value": "${{ inputs.actor }}", "short": true },
                    { "title": "Error", "value": "ÂÖ•Âäõ„Åï„Çå„Åüref„ÅåSTGÁí∞Â¢É„ÅÆref„Å®‰∏ÄËá¥„Åó„Åæ„Åõ„Çì„ÄÇPRDÁí∞Â¢É„Å´„ÅØSTGÁí∞Â¢É„Å®Âêå„Åòref„Çí„Éá„Éó„É≠„Ç§„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", "short": false }
                  ]
                }
              ]
            }
      - name: "Send ref not found notification"
        if: ${{ inputs.type == 'ref-not-found' }}
        uses: slackapi/slack-github-action@v2.1.0
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {
              "text": "‚ö†Ô∏è ref„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì",
              "attachments": [
                {
                  "color": "warning",
                  "fields": [
                    { "title": "Environment", "value": "${{ inputs.environment }}", "short": true },
                    { "title": "Input Ref", "value": "${{ inputs.branch }}", "short": true },
                    { "title": "Triggered by", "value": "${{ inputs.actor }}", "short": true },
                    { "title": "Error", "value": "ÂÖ•Âäõ„Åï„Çå„Åüref„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ", "short": false }
                  ]
                }
              ]
            }
